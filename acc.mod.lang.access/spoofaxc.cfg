name = "AccModLangAccess"
java-class-id-prefix = java AccModLangAccess
file-extension = "aml2"

sdf3 {}
esv {}
statix {}
stratego {}

parser {
  default-start-symbol = sort Start
}
styler {}
constraint-analyzer {
  default-statix-message-stacktrace-length = 8
}
stratego-runtime {}
reference-resolution {
  variant = stratego {
    strategy = strategy editor-resolve
  }
}
hover {
  variant = stratego {
    strategy = strategy editor-hover
  }
}

build-dependencies [
  org.metaborg:strategolib:*
  org.metaborg:gpp:*
  org.metaborg:libspoofax2:*
  org.metaborg:libstatix:*
  ../acc.mod.lang
]

let transformToJavaTask = task-def mb.acc.mod.lang.access.tasks.TransformToJava
let testJavaCompatTask = task-def mb.acc.mod.lang.access.tasks.TestJavaCompat

let testJavaCompatCommand = command-def {
  task-def = testJavaCompatTask
  display-name = "Test Java Compatibility"
  parameters = [
    file {
      type = java mb.resource.ResourceKey
      required = true
      argument-providers = [Context(File)]
    }
    rootDirectory {
      type = java mb.resource.hierarchical.ResourcePath
      required = true
      argument-providers = [EnclosingContext(Project)]
    }
  ]
}

editor-context-menu [
  menu "Transform" [
    command-action {
      command-def = testJavaCompatCommand
      execution-type = Once
      required-resource-types = [File]
      required-enclosing-resource-types = [Project]
    }
  ]
]

resource-context-menu [
  menu "Transform" [
    command-action {
      command-def = testJavaCompatCommand
      execution-type = Once
      required-resource-types = [File]
      required-enclosing-resource-types = [Project]
    }
  ]
]